<div class="bg-light lter b-b wrapper-md" >
    <h1 class="m-n font-thin h3">Voyage</h1>
    <small class="text-muted">{{'search.legend'| translate }}</small>
</div>

<div class="wrapper-md"  ng-controller="VoyageList">

    <div class="panel panel-default">
        <div class="panel-heading">
            <form class="form-inline form-validation" role="form"  NAME="searchform1"     ng-submit="search()">
                <div class="form-group">
                    <label>Date</label>
                    <input    class="form-control"  required=""   type="date"    ng-model="searchVoyage.date"   ng-model-options="{timezone:'UTC'}" /> 
                </div>
                <div class="form-group">
                    <label    class="col-lg-offset-1 col-lg-2 control-label">Trajet<span style="color:red">*</span>
                    </label> 
                    <div class="col-lg-6">
                        <select   ng-model="searchVoyage.trajet"   class="form-control"
                                  ng-options="t as t.libelle  for t in trajets"   >
                            <option>--</option>
                        </select>
                    </div>

                </div>
                <div class="form-group">
                    <label    class="col-lg-offset-1 col-lg-2 control-label">Agence<span style="color:red">*</span>
                    </label> 
                    <div class="col-lg-6">
                        <select   ng-model="searchVoyage.agence"   class="form-control"
                                  ng-options="t as t.libelle  for t in agences"   >
                            <option>--</option>
                        </select>
                    </div>

                </div>


                <button class="btn btn-primary" type="submit" >
                    <i class="fa fa-search"  ng-show="!errorService.waiting">{{'search.mot'| translate }}</i>
                    <i class="fa fa-spinner faa-spin animated" ng-show="errorService.waiting"></i>
                    <span ng-show="errorService.waiting">Loading...</span>
                </button>

            </form>
        </div>
        <div class="panel-body table-responsive">
            <table datatable="" dt-options="dtOptions" 
                   dt-columns="dtColumns" 
                   class="table table-striped table-bordered table-hover" 
                   id="dataTables-example" width="100%">
            </table>

        </div>
    </div>
</div>



<script type="text/javascript" >

    app.controller("VoyageList",
            function VoyageList($scope, $http, toaster, $state, ErrorService, $stateParams, DTColumnBuilder, DTOptionsBuilder, $modal, $log) {
                 $scope.categorie = 'Voyage';
                $http.get('Trajet/list')
                        .success(function (data) {
                            $scope.trajets = data;
                        });
                $http.get('Agence/list/-1')
                        .success(function (data) {
                            $scope.agences = data;
                        });

                $scope.dtColumns = [
                    DTColumnBuilder.newColumn('code').withTitle('code').notVisible(),
                    DTColumnBuilder.newColumn('trajet.libelle').withTitle('Trajet'),
                    DTColumnBuilder.newColumn('dateDepart').withTitle('Jour Depart'),
                    DTColumnBuilder.newColumn('heureDepart').withTitle('Heure Depart'),
                    DTColumnBuilder.newColumn('statut').withTitle('Statut'),
                    DTColumnBuilder.newColumn('agence.libelle').withTitle('Agence'),
                    DTColumnBuilder.newColumn('bus.libelle').withTitle('Bus'),
                    DTColumnBuilder.newColumn('chauffeur.nom_prenom').withTitle('Chauffeur')
                ];

                $scope.dtOptions = DTOptionsBuilder
                        .fromSource('Voyage/list')
                        .withPaginationType('full')
                        .withBootstrap()
                        // Add Table tools compatibility
                        .withTableTools('vendor/jquery/datatables/copy_csv_xls.swf')
                        .withTableToolsOption("sRowSelect", "multi")
                        .withTableToolsButtons([
                            "addrow", "editrow", "delrow", "csv", "select_all", "select_none"
                        ])
                        ;


                $.fn.dataTable.TableTools.buttons.addrow = $.extend(
                        {}, $.fn.dataTable.TableTools.buttonBase,
                        {
                            "sButtonText": "<i class=\"fa fa-plus\"></i>",
                            "sToolTip": "New Data",
                            "fnClick": function (nButton, oConfig) {
                                $state.go('app.form.elt', {categorie: $scope.categorie});
                            }

                        }
                );
                $.fn.dataTable.TableTools.buttons.editrow = $.extend(
                        {}, $.fn.dataTable.TableTools.BUTTONS.select,
                        {
                            "sButtonText": "<i class=\"fa fa-edit\"></i>",
                            "sToolTip": "Edit Data",
                            "fnClick": function (nButton, oConfig) {
                                $state.go('app.form.elt', {id: (this.fnGetSelectedData()[0]).code, categorie: $scope.categorie});
                            }
                        }
                );

                $.fn.dataTable.TableTools.buttons.delrow = $.extend(
                        {}, $.fn.dataTable.TableTools.BUTTONS.select,
                        {
                            "sButtonText": "<i class=\"fa fa-trash-o\"></i>",
                            "sToolTip": "Delete Data",
                            "fnClick": function (nButton, oConfig) {
                                //confirm dialogue
                                var r = confirm("Confirm ?");
                                if (r == true) {
                                    $http.get($scope.categorie + '/del/' + (this.fnGetSelectedData()[0]).code)
                                            .success(function (data) {
                                                toaster.pop("success", "Success", "Suppression Effectuée avec Succès");
                                                $('#dataTables-example').DataTable().ajax.reload();
                                            }).error(function (data) {
                                        toaster.pop("error", "Error", data);
                                        $('#dataTables-example').DataTable().ajax.reload();
                                    });
                                }
                                ;

                            }
                        }
                );
            });

</script>
