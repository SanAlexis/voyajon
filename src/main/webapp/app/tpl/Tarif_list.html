<div class="box-body  table-responsive"  ng-controller="TarifList">
    <table datatable="" dt-options="dtOptions" dt-columns="dtColumns" class="table table-striped table-bordered table-hover" id="dataTables-example" width="100%">
    </table>
</div>

<script type="text/javascript" >

    app.controller("TarifList",
            function TarifList($scope, $http, toaster, $state, ErrorService, $stateParams, DTColumnBuilder, DTOptionsBuilder, $modal, $log) {

                $scope.dtColumns = [
                    DTColumnBuilder.newColumn('code').withTitle('code').notVisible(),
                    DTColumnBuilder.newColumn('trajet.libelle').withTitle('Trajet'),
                    DTColumnBuilder.newColumn('prix_classic_aller').withTitle('Classic Aller Simple'),
                    DTColumnBuilder.newColumn('prix_classic_aller_retour').withTitle('Classic Aller Retour'),
                    DTColumnBuilder.newColumn('prix_vip_aller').withTitle('VIP Aller Simple'),
                    DTColumnBuilder.newColumn('prix_vip_aller_retour').withTitle('VIP Aller Retour')
                   
                ];

                $scope.dtOptions = DTOptionsBuilder
                        .fromSource('Tarif/list/' + $stateParams.id)
                        .withPaginationType('full')
                        .withBootstrap()
                        // Add Table tools compatibility
                        .withTableTools('vendor/jquery/datatables/copy_csv_xls.swf')
                        .withTableToolsOption("sRowSelect", "multi")
                        .withTableToolsButtons([
                            "addrow", "editrow", "delrow", "csv", "select_all", "select_none"
                        ])
                        ;


                $.fn.dataTable.TableTools.buttons.addrow = $.extend(
                        {}, $.fn.dataTable.TableTools.buttonBase,
                        {
                            "sButtonText": "<i class=\"fa fa-plus\"></i>",
                            "sToolTip": "New Data",
                            "fnClick": function (nButton, oConfig) {
                                $scope.openFormTarif('lg', -1);
                            }

                        }
                );
                $.fn.dataTable.TableTools.buttons.editrow = $.extend(
                        {}, $.fn.dataTable.TableTools.BUTTONS.select,
                        {
                            "sButtonText": "<i class=\"fa fa-edit\"></i>",
                            "sToolTip": "Edit Data",
                            "fnClick": function (nButton, oConfig) {
                                $scope.openFormTarif('lg', (this.fnGetSelectedData()[0]).code);
                            }
                        }
                );

                $.fn.dataTable.TableTools.buttons.delrow = $.extend(
                        {}, $.fn.dataTable.TableTools.BUTTONS.select,
                        {
                            "sButtonText": "<i class=\"fa fa-trash-o\"></i>",
                            "sToolTip": "Delete Data",
                            "fnClick": function (nButton, oConfig) {
                                //confirm dialogue
                                var r = confirm("Confirm ?");
                                if (r == true) {
                                    $http.get($scope.categorie + '/del/' + (this.fnGetSelectedData()[0]).code)
                                            .success(function (data) {
                                                toaster.pop("success", "Success", "Suppression Effectuée avec Succès");
                                                $('#dataTables-example').DataTable().ajax.reload();
                                            }).error(function (data) {
                                        toaster.pop("error", "Error", data);
                                        $('#dataTables-example').DataTable().ajax.reload();
                                    });
                                }
                                ;

                            }
                        }
                );


                $scope.openFormTarif = function (size, code) {
                    var modalInstance = $modal.open({
                        templateUrl: 'tpl/Tarif_form.html',
                        controller: 'TarifForm',
                        size: size,
                        resolve: {
                            code: function () {
                                return code;
                            }
                        }
                    });

                    modalInstance.result.then(function () {
                        $log.info('Modal closed at: ' + new Date());
//                    $state.reload();
                        $('#dataTables-example').DataTable().ajax.reload();
                    }, function () {
                        $log.info('Modal dismissed at: ' + new Date());
//                    $state.reload();
                        $('#dataTables-example').DataTable().ajax.reload();
                    });
                };


            });

    app.controller("TarifForm",
            function TarifForm($scope, $modalInstance, $http, toaster, ErrorService, $stateParams, code) {
                $scope.categorie = 'Tarif';
                $scope.errorService = ErrorService;
                $scope.errorService.clear();

                $http.get($scope.categorie + '/find/' + code)
                        .success(function (data) {
                            $scope.tsoftitem = data;
                        });
                $http.get('Trajet/list')
                        .success(function (data) {
                            $scope.trajets = data;
                        });
                $scope.master = angular.copy($scope.tsoftitem);

                $scope.reset = function () {
                    $scope.tsoftitem = angular.copy($scope.master);
                    $scope.form.$setPristine();
                };

                $scope.del = function (code) {
                    var r = confirm("Confirm ?");
                    if (r == true) {
                        $http.get($scope.categorie + '/del/' + code)
                                .success(function (data) {
                                    toaster.pop("success", "Success", "Suppression Effectuée avec Succès");
                                }).error(function (data) {
                            toaster.pop("error", "Error", data);
                        });

                    }

                };

                $scope.save = function () {
                    $scope.errorService.setwaiting();
                    $http.post( $scope.categorie + '/save/' + $stateParams.id,$scope.tsoftitem)
                            .success(function (data) {
                                toaster.pop("success", "Success", "Operation Effectuée avec Succès");
                                $scope.errorService.setSucces();
                                $scope.closemodal();
                            });
                };

                $scope.closemodal = function () {
                    $modalInstance.dismiss('cancel');
                };




            });
</script>
