<div class="bg-light lter b-b wrapper-md" ng-controller="VoyageForm">
    <div class="btn-toolbar pull-right">
        <div class=" btn-group pull-right ">
            <button type="button" class="btn btn-default" ng-click=" $state.go('app.table.list', {categorie: categorie});"   tooltip="List">
                <i class="fa fa-th-list"></i>  
            </button>
        </div>



    </div>
    <h1 class="m-n font-thin h3">    {{categorie}} </h1>
    <small class="text-muted"  translate="form.legend">Fields marked with * are required</small>
</div>
<!-- Main content -->
<div class="wrapper-md"  ng-controller="VoyageForm">

    <div class="row"  ng-show="app.settings.debugmode">
        <div class="col-lg-12">
            <pre>{{tsoftitem}}</pre>
        </div>
    </div>

    <div class="panel panel-info"> 
        <div class="panel-body"  >
            <fieldset>
                <tabset justified="false"  type="pills" vertical="false" >
                    <tab>
                        <tab-heading  >Voyage</tab-heading>
                        <br>
                        <form      ng-submit="save()"  novalidate="true"
                                   name="form"   method="POST"    id="form"    class="form-validation form-horizontal"  >

                            <div class="form-group"  >
                                <label    class="col-lg-offset-1 col-lg-2 control-label">Bus<span style="color:red">*</span>
                                </label> 
                                <div class="col-lg-6">
                                    <select   ng-model="tsoftitem.bus" required=""  class="form-control"
                                              ng-options="v as v.libelle  for v in bus"   >
                                        <option>--</option>
                                    </select>
                                </div>

                            </div>
                            <div class="form-group"  >
                                <label    class="col-lg-offset-1 col-lg-2 control-label">Chauffeur
                                </label> 
                                <div class="col-lg-6">
                                    <select   ng-model="tsoftitem.chauffeur"   class="form-control"
                                              ng-options="v as v.libelle  for v in chauffeurs"   >
                                        <option>--</option>
                                    </select>
                                </div>

                            </div>
                            <div class="form-group"  >
                                <label    class="col-lg-offset-1 col-lg-2 control-label">Trajet<span style="color:red">*</span>
                                </label> 
                                <div class="col-lg-6">
                                    <select   ng-model="tsoftitem.trajet" required=""  class="form-control"
                                              ng-options="v as v.libelle  for v in trajets"   >
                                        <option>--</option>
                                    </select>
                                </div>

                            </div>
                            <div class="form-group"  >
                                <label    class="col-lg-offset-1 col-lg-2 control-label">Agence<span style="color:red">*</span>
                                </label> 
                                <div class="col-lg-6">
                                    <select   ng-model="tsoftitem.agence" required=""  class="form-control"
                                              ng-options="v as v.libelle  for v in agences"   >
                                        <option>--</option>
                                    </select>
                                </div>

                            </div>
                            <div class="form-group"  >
                                <label    class="col-lg-offset-1 col-lg-2 control-label">Date Heure Depart<span style="color:red">*</span>
                                </label> 
                                <div class="col-lg-3">
                                    <input    class="form-control"   required="" type="time"    ng-model="tsoftitem.heureDepart"   ng-model-options="{timezone:'UTC'}" />
                                </div>
                                <div class="col-lg-3">
                                    <input    class="form-control"  required=""  type="date"     ng-model="tsoftitem.dateDepart"   ng-model-options="{timezone:'UTC'}" />
                                </div>

                            </div>
                            <div class="form-group"  >
                                <label    class="col-lg-offset-1 col-lg-2 control-label">Date Heure Arrivee
                                </label> 
                                <div class="col-lg-3">
                                    <input    class="form-control"   required="" type="time"    ng-model="tsoftitem.heureArrivee"   ng-model-options="{timezone:'UTC'}" />
                                </div>
                                <div class="col-lg-3">
                                    <input    class="form-control"  required=""  type="date"     ng-model="tsoftitem.dateArrivee"   ng-model-options="{timezone:'UTC'}" />
                                </div>

                            </div>
                            <div class="form-group"  >
                                <label    class="col-lg-offset-1 col-lg-2 control-label">Statut
                                </label> 
                                <div class="col-lg-6">
                                    <select   ng-model="tsoftitem.statut"   class="form-control">
                                        <option>--</option>
                                        <option>PROGRAMME</option>
                                        <option>DEPART</option>
                                        <option>RETARDE</option>
                                        <option>ARRIVE</option>
                                        <option>ANNULE</option>
                                    </select>
                                </div>

                            </div>
                            <div class="form-group"  >
                                <label    class="col-lg-offset-1 col-lg-2 control-label">Nbre Places Confirmées
                                </label> 
                                <div class="col-lg-6"><input type="number" class="form-control"  readonly=""  ng-model="tsoftitem.nbre_places_confirmees"></div>

                            </div>
                            <div class="form-group"  >
                                <label    class="col-lg-offset-1 col-lg-2 control-label">Nbre Places Reservees
                                </label> 
                                <div class="col-lg-6"><input type="number" class="form-control"  readonly=""  ng-model="tsoftitem.nbre_places_reservees"></div>

                            </div>

                            <div class="form-group">
                                <div class="col-lg-offset-3  col-lg-6">
                                    <button type="submit" class="btn btn-primary"    ng-disabled="form.$invalid || form.$pristine"    >
                                        <i class="fa fa-save"  ng-show="!errorService.waiting">{{'form.save'| translate}}</i>
                                        <i class="fa fa-spinner faa-spin animated" ng-show="errorService.waiting"></i>
                                        <span ng-show="errorService.waiting">Loading...</span>
                                    </button>
                                    <button   type="button" class="btn btn-default"  ng-click="reset()"  > <i class="glyphicon  glyphicon-remove"></i>{{'form.reset'| translate}}</button>

                                </div>
                            </div>

                        </form>

                    </tab>

                    <tab   disabled="!(tsoftitem.code)"  select="$state.go('app.form.elt.agence')">
                        <tab-heading> Reservations</tab-heading>
                        <br>
                        <div ui-view="AgenceListView"></div>
                    </tab>
                    <tab   disabled="!(tsoftitem.code)"  select="$state.go('app.form.elt.agence')">
                        <tab-heading> Passagers</tab-heading>
                        <br>
                        <div ui-view="AgenceListView"></div>
                    </tab>

                </tabset>
            </fieldset>

        </div>



    </div>

</div>

<script type="text/javascript" >

    app.controller("VoyageForm",
            function VoyageForm($scope, $http, toaster, $state, ErrorService, $stateParams, DTColumnBuilder, DTOptionsBuilder) {
                $scope.categorie = 'Voyage';
                $scope.errorService = ErrorService;
                $scope.errorService.clear();

                $http.get('Trajet/list')
                        .success(function (data) {
                            $scope.trajets = data;
                        });
                $http.get('Chauffeur/list')
                        .success(function (data) {
                            $scope.chauffeurs = data;
                        });
                $http.get('Bus/list')
                        .success(function (data) {
                            $scope.bus = data;
                        });
                $http.get('Agence/list/-1')
                        .success(function (data) {
                            $scope.agences = data;
                        });
                $http.get($scope.categorie + '/find/' + $stateParams.id)
                        .success(function (data) {
                            $scope.tsoftitem = data;
                        });
                $scope.master = angular.copy($scope.tsoftitem);

                $scope.reset = function () {
                    $scope.tsoftitem = angular.copy($scope.master);
                    $scope.form.$setPristine();
                };

                $scope.del = function (code) {
                    var r = confirm("Confirm ?");
                    if (r == true) {
                        $http.get($scope.categorie + '/del/' + code)
                                .success(function (data) {
                                    toaster.pop("success", "Success", "Suppression Effectuée avec Succès");
                                    $state.go('app.table.list', {categorie: $scope.categorie})
                                }).error(function (data) {
                            toaster.pop("error", "Error", data);
                        });

                    }

                };

                $scope.save = function () {
                    $scope.errorService.setwaiting();
                    $http.post($scope.categorie + '/save', $scope.tsoftitem)
                            .success(function (data) {
                                toaster.pop("success", "Success", "Operation Effectuée avec Succès");
                                $scope.errorService.setSucces();
                                $scope.form.$setPristine();
                                alert(data);
                                $scope.tsoftitem = data;
                            });
                };





            });
</script>


