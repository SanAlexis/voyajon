<div ng-controller="FullcalendarCtrl">
    <div class="wrapper-md bg-light b-b">
        <div class="btn-toolbar pull-right">
            <div class=" btn-group pull-right ">
                <button type="button" class="btn btn-default" ng-click=" $state.go('app.table.list', {categorie: 'Voyage'});"   tooltip="List">
                    <i class="fa fa-th-list"></i>  
                </button>
            </div>
        </div>
        <h1 class="m-n font-thin h3">Voyage</h1>
    </div>
    <div class="hbox hbox-auto-xs hbox-auto-sm">
        <div class="col wrapper-md">
            <div class="clearfix m-b">
                <button type="button" tooltip="Double click on calendar day to create event" class="btn btn-sm btn-primary btn-addon" ng-click="addEvent()">
                    <i class="fa fa-plus"></i>Add
                </button>
                <div class="pull-right">
                    <button type="button" class="btn btn-sm btn-default" ng-click="today()">today</button>
                    <div class="btn-group m-l-xs">
                        <button class="btn btn-sm btn-default" ng-click="changeView('agendaDay')">Day</button>
                        <button class="btn btn-sm btn-default" ng-click="changeView('agendaWeek')">Week</button>
                    </div>
                </div>
            </div>
            <div class="pos-rlt">
                <div class="fc-overlay">
                    <div class="panel bg-white b-a pos-rlt">
                        <span class="arrow"></span>
                        <div class="ng-hide" ng-show='event.heureDepart'><i class="icon-clock text-muted m-r-xs"></i> {{event.heureDepart}}--{{event.heureArrivee}}</div>
                        <div class="ng-hide" ng-show='event.agence.libelle'><i class="icon-pointer text-muted m-r-xs"></i> {{event.agence.libelle}}</div>
                        <div class="ng-hide" ng-show='event.trajet.libelle'><i class="icon-shuffle text-muted m-r-xs"></i> {{event.trajet.libelle}}</div>
                        <div class="ng-hide" ng-show='event.statut'><i class="icon-pointer text-muted m-r-xs"></i> {{event.statut}}</div>
                    </div>
                </div>
                <div class="calendar" ng-model="eventSources" config="uiConfig.calendar" ui-calendar="uiConfig.calendar"></div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript" >
    /**
     * calendarDemoApp - 0.1.3
     */

    app.controller('FullcalendarCtrl', ['$scope', function ($scope) {

            /* event source that pulls from google.com */
            $scope.eventSource = {
                url: "VoyageCalendar",
                className: 'gcal-event'         // an option!
            };



            /* alert on dayClick */
            $scope.precision = 400;
            $scope.lastClickTime = 0;
            $scope.alertOnEventClick = function (date, jsEvent, view) {
                var time = new Date().getTime();
                if (time - $scope.lastClickTime <= $scope.precision) {
                    $scope.events.push({
                        title: 'New Event',
                        start: date,
                        className: ['b-l b-2x b-info']
                    });
                }
                $scope.lastClickTime = time;
            };
            /* alert on Drop */
            $scope.alertOnDrop = function (event, delta, revertFunc, jsEvent, ui, view) {
                $scope.alertMessage = ('Event Droped to make dayDelta ' + delta);
            };
            /* alert on Resize */
            $scope.alertOnResize = function (event, delta, revertFunc, jsEvent, ui, view) {
                $scope.alertMessage = ('Event Resized to make dayDelta ' + delta);
            };

            $scope.overlay = $('.fc-overlay');
            $scope.alertOnMouseOver = function (event, jsEvent, view) {
                $scope.event = event;
                $scope.overlay.removeClass('left right top').find('.arrow').removeClass('left right top pull-up');
                var wrap = $(jsEvent.target).closest('.fc-event');
                var cal = wrap.closest('.calendar');
                var left = wrap.offset().left - cal.offset().left;
                var right = cal.width() - (wrap.offset().left - cal.offset().left + wrap.width());
                var top = cal.height() - (wrap.offset().top - cal.offset().top + wrap.height());
                if (right > $scope.overlay.width()) {
                    $scope.overlay.addClass('left').find('.arrow').addClass('left pull-up')
                } else if (left > $scope.overlay.width()) {
                    $scope.overlay.addClass('right').find('.arrow').addClass('right pull-up');
                } else {
                    $scope.overlay.find('.arrow').addClass('top');
                }
                if (top < $scope.overlay.height()) {
                    $scope.overlay.addClass('top').find('.arrow').removeClass('pull-up').addClass('pull-down')
                }
                (wrap.find('.fc-overlay').length == 0) && wrap.append($scope.overlay);
            };

            /* config object */
            $scope.uiConfig = {
                calendar: {
                    height: 450,
                    editable: true,
                    header: {
                        left: 'prev',
                        center: 'title',
                        right: 'next'
                    },
                    defaultView:'agendaWeek',
                    allDaySlot:false,
                    minTime: "04:00:00",
                    maxTime: "23:00:00",
                    dayClick: $scope.alertOnEventClick,
                    eventDrop: $scope.alertOnDrop,
                    eventResize: $scope.alertOnResize,
                    eventMouseover: $scope.alertOnMouseOver
                }
            };

           
            /* Change View */
            $scope.changeView = function (view, calendar) {
                $('.calendar').fullCalendar('changeView', view);
            };

            $scope.today = function (calendar) {
                $('.calendar').fullCalendar('today');
            };

            /* event sources array*/
            $scope.eventSources = [$scope.eventSource];
        }]);
    /* EOF */

</script>