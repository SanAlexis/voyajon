<div class="bg-light lter b-b wrapper-md" >
    <div class="btn-toolbar pull-right">
        <div class=" btn-group pull-right ">
            <button type="button" class="btn btn-default" ng-click=" $state.go('app.calendar');"   tooltip="Calendar">
                <i class="fa fa-calendar"></i>  
            </button>
        </div>
    </div>
    <h1 class="m-n font-thin h3">Voyage</h1>
    <small class="text-muted">{{'search.legend'| translate }}</small>
</div>

<div class="wrapper-md"  ng-controller="VoyageList">

    <div class="panel panel-default">
        <div class="panel-heading">
            <form class="form-inline form-validation" role="form"  NAME="searchform1"     ng-submit="search()">
                <div class="form-group">
                    <label>Date<span style="color:red">*</span></label>
                    <div class="input-group w-md">
                        <input type="text" class="form-control" datepicker-popup="dd/MM/yyyy"  placeholder="dd/MM/yyyy" ng-model="searchVoyage.date_depart"   
                               min-date="today"  is-open="opened" datepicker-options="dateOptions" 
                               ng-required="true"   show-button-bar="false"  />
                        <span class="input-group-btn">
                            <button type="button" class="btn btn-default" ng-click="open($event)"><i class="glyphicon glyphicon-calendar"></i></button>
                        </span>
                    </div>
                </div>
                <div class="form-group">
                    <label    class="control-label">Trajet
                    </label> 
                    <select   ng-model="searchVoyage.trajet"   class="form-control"  
                              ng-options="t as t.libelle  for t in trajets"   >
                        <option>--</option>
                    </select>
                </div>
                <div class="form-group">
                    <label    class="control-label">Agence
                    </label> 
                    <select   ng-model="searchVoyage.agence"   class="form-control"
                              ng-options="t as t.libelle  for t in agences"   >
                        <option>--</option>
                    </select>
                </div>

                <div class="form-group">
                     <button class="btn btn-primary" type="submit"  ng-disabled="searchform1.$invalid || searchform1.$pristine">
                        <i class="fa fa-search"  ng-show="!errorService.waiting">{{'search'| translate }}</i>
                        <i class="fa fa-spinner faa-spin animated" ng-show="errorService.waiting"></i>
                        <span ng-show="errorService.waiting">Loading...</span>
                    </button>
                </div>

                <div class="form-group pull-right">
                    <label  class="control-label">Show</label>
                    <select class="form-control" ng-model="itemsByPage">
                        <option value="5">5</option>
                        <option value="10">10</option>
                        <option  value="25">25</option>
                        <option value="50">50</option>
                        <option  value="100">100</option>
                    </select>
                </div>
            </form>

        </div>
        <div class="panel-body table-responsive">
            <table  class="table table-striped table-bordered table-hover"  st-safe-src="rowCollection"  st-table="displayedCollection">
                <thead>
                    <tr>
                        <th st-sort="trajet.libelle">Trajet</th>
                        <th st-sort="dateDepart">Date</th>
                        <th st-sort="heureDepart">Heure</th>
                        <th st-sort="statut">Statut</th>
                        <th st-sort="agence.libelle">Agence</th>
                        <th st-sort="bus.libelle">Bus</th>
                        <th st-sort="chauffeur.nom_prenom">Chauffeur</th>
                        <th> 
                            <button type="button" class="btn btn-primary" ng-click="add();"  
                                    tooltip="{{'form.add'| translate}}">
                                <i class="fa fa-plus"></i>  
                            </button>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="row in displayedCollection" st-select-row="row">
                        <td>{{row.trajet.libelle}}</td>
                        <td>{{row.dateDepart| date}}</td>
                        <td>{{row.heureDepart}}</td>
                        <td>{{row.statut}}</td>
                        <td>{{row.agence.libelle}}</td>
                        <td>{{row.bus.libelle}}</td>
                        <td>{{row.chauffeur.nom_prenom}}</td>
                        <td>
                            <button type="button" ng-click="edit(row);" class="btn btn-sm btn-default">
                                <i class="fa fa-edit">
                                </i>
                            </button>

                            <button type="button" ng-click="delete(row);" class="btn btn-sm btn-danger"  tooltip="Annule">
                                <i class="fa fa-remove">
                                </i>
                            </button>
                        </td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <td   class="text-center">
                            <div st-pagination="" st-items-by-page="itemsByPage"  class="no-margin"></div>
                        </td>
                    </tr>
                </tfoot>
            </table>


        </div>
    </div>
</div>



<script type="text/javascript" >

    app.controller("VoyageList",
            function VoyageList($scope, $http, toaster, $state, ErrorService, CrudService) {
                $scope.categorie = 'Voyage';
                $scope.errorService = ErrorService;
                $scope.errorService.clear();
                $scope.rowCollection = CrudService.query({categorie: $scope.categorie});
                //  pagination
                $scope.itemsByPage = 10;

                $scope.delete = function (row) {
                    
                };
                $scope.edit = function (row) {
                    $state.go('app.form.elt', {categorie: $scope.categorie, id: row.code});
                };
                $scope.add = function () {
                    $state.go('app.form.elt', {categorie: $scope.categorie,id:-1});
                };

                $scope.search = function () {
                    $scope.errorService.setwaiting();
                    $http.post('Voyage/search', $scope.searchVoyage)
                            .success(function (data) {
                                $scope.errorService.setSucces();
                                $scope.rowCollection = data;
                                if(data.length==0)  alert('Aucun Voyage Correspond Ã  cette recherche');
                            });
                };
                $scope.trajets = CrudService.query({categorie: 'Trajet'});
                $scope.agences = CrudService.query({categorie: 'Agencelist', id: -1});

                $scope.open = function ($event) {
                    $event.preventDefault();
                    $event.stopPropagation();
                    $scope.opened = true;
                };
                $scope.dateOptions = {
                    formatYear: 'yy',
                    startingDay: 1,
                    class: 'datepicker'
                };
                $scope.today = new Date();

            });

</script>
