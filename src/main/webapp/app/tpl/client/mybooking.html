<div  ng-controller="ReservationCtrl">
    <div class="bg-light lter b-b wrapper-md">
        <div class="btn-toolbar pull-right">
            <div class=" btn-group pull-right ">
                <button type="button" class="btn btn-default"    tooltip="Home"  ng-click="$state.go('client.home');">
                    <i class="fa fa-home"></i>  
                </button>
                <button type="button" class="btn btn-default"    tooltip="Search"  ng-click="toggleSearchOk();"  ng-if="searchOk">
                    <i class="fa fa-search"></i>  
                </button>
            </div>
        </div>
        <h1 class="m-n font-thin h3"><i class="fa fa-ticket pull-left"></i>{{'mybooking'| translate }}</h1>
        <small class="text-muted">{{'mybooking1'| translate }}</small>
    </div>
    <div class="wrapper-md"   >
        <div class="row">
            <div class="col-sm-12">
                <div class="panel panel-info"  ng-show="!searchOk">
                    <div class="panel-body" >
                        <form class="form-horizontal form-validation" role="form"  name="searchform"  id="searchform"    ng-submit="search()">

                            <div class="form-group">
                                <label    class="col-sm-offset-3 col-sm-2 control-label">{{'phone'| translate }}
                                </label> 
                                <div class="col-sm-2">
                                    <input    class="form-control"  ng-required="!booking.email"   type="tel"    ng-model="booking.telephone"    /> 
                                </div>
                            </div>
                            <div class="form-group">
                                <label    class="col-sm-offset-3 col-sm-2 control-label">Email
                                </label> 
                                <div class="col-sm-2">
                                    <input    class="form-control"  ng-required="!booking.telephone"    type="email"    ng-model="booking.email"    /> 
                                </div>
                            </div>


                            <div class="form-group">
                                <div class="col-sm-offset-5 col-sm-2">
                                    <button class="btn btn-block btn-primary" type="submit"  ng-disabled="searchform.$invalid || searchform.$pristine"  >
                                        <i class="fa fa-search"  ng-show="!errorService.waiting">{{'search'| translate }}</i>
                                        <i class="fa fa-spinner faa-spin animated" ng-show="errorService.waiting"></i>
                                        <span ng-show="errorService.waiting">Loading...</span>
                                    </button>
                                </div>
                            </div>
                        </form>

                    </div>
                </div>

            </div>
        </div>
        <div class="row">
            <div class="col-sm-12">
                <div class="panel panel-default"  ng-show="searchOk">
                    <div class="panel-body table-responsive"  >
                        <table   class="table table-striped table-bordered table-hover"    id="dataTables-example1" width="100%">
                            <thead>
                            <th>{{'booking'| translate}}</th>
                            <th>Cancel</th>
                            </thead>
                            <tbody>
                                <tr  ng-if="!resas.length">
                                    <td colspan="2">
                                        {{'nodata'| translate }}
                                    </td>
                                </tr>
                                <tr  ng-repeat="r in resas">
                                    <td >
                                        <span class="arrow"></span>
                                        <div class="ng-hide" ng-show='r.voyage.heureDepart'><i class="icon-clock text-muted m-r-xs"></i> {{r.voyage.heureDepart}}--{{r.voyage.heureArrivee}}</div>
                                        <div class="ng-hide" ng-show='r.voyage.agence.libelle'><i class="icon-pointer text-muted m-r-xs"></i> {{r.voyage.agence.libelle}}</div>
                                        <div class="ng-hide" ng-show='r.voyage.vip'><i class="icon-pointer text-muted m-r-xs"></i> {{r.voyage.vip}}</div>
                                        <div class="ng-hide" ng-show='r.voyage.statut'><i class="icon-pointer text-muted m-r-xs"></i> {{r.voyage.statut}}</div>

                                    </td>
                                    <td>
                                        <span class="arrow"></span>
                                        <div class="ng-hide"><button  class="btn btn-block btn-primary"  ng-click="cancel(r.code);"><i class="fa fa-remove"></i></button></div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
    app.controller("ReservationCtrl", function ReservationCtrl($scope, ErrorService, $http, CrudService, $modal, $log, toaster) {
        $scope.errorService = ErrorService;
        $scope.errorService.clear();

        $scope.toggleSearchOk = function () {
            $scope.searchOk = !$scope.searchOk;
        };

        $scope.searchOk = false;

        $scope.search = function () {
            $scope.errorService.setwaiting();
            $http.post('client/MyBookings', $scope.booking)
                    .success(function (data) {
                        $scope.errorService.setSucces();
                        $scope.toggleSearchOk();
                        $scope.resas = data;
                    });
        };
        $scope.cancel = function (code) {
            $http.get('client/CancelResa/' + code)
                    .success(function (data) {
                        $scope.search();
                    });
        };

    })
            ;

</script>