
<div class="bg-light lter b-b wrapper-md" >
    <h1 class="m-n font-thin h3">Compagnie</h1>
    <small class="text-muted">{{'search.legend'| translate }}</small>
</div>

<div class="wrapper-md"  ng-controller="CompagnieList">

    <div class="panel panel-default">
        <div class="panel-body table-responsive">
            <table datatable="" dt-options="dtOptions" 
                   dt-columns="dtColumns" 
                   class="table table-striped table-bordered table-hover" 
                   id="dataTables-example" width="100%">
            </table>

        </div>
    </div>
</div>

<script type="text/javascript" >

    app.controller("CompagnieList",
            function CompagnieList($scope, $http, DTOptionsBuilder, DTColumnBuilder, toaster, $state) {
                $scope.categorie = 'Compagnie';
                $scope.dtColumns = [
                    DTColumnBuilder.newColumn('code').withTitle('code').notVisible(),
                    DTColumnBuilder.newColumn('libelle').withTitle('Nom'),
                    DTColumnBuilder.newColumn('siteweb').withTitle('Site Web')
                ];

                $scope.dtOptions = DTOptionsBuilder
                        .fromSource( $scope.categorie + '/list')
                        .withPaginationType('full')
                        .withBootstrap()
                        // Add Table tools compatibility
                        .withTableTools('vendor/jquery/datatables/copy_csv_xls.swf')
                        .withTableToolsOption("sRowSelect", "multi")
                        .withTableToolsButtons([
                          "addrow", "editrow", "delrow", "csv", "select_all", "select_none"
                        ])
                        ;
               

                $.fn.dataTable.TableTools.buttons.addrow = $.extend(
                        {}, $.fn.dataTable.TableTools.buttonBase,
                        {
                            "sButtonText": "<i class=\"fa fa-plus\"></i>",
                            "sToolTip": "New Data",
                            "fnClick": function (nButton, oConfig) {
                                $state.go('app.form.elt', { categorie: $scope.categorie});
                            }

                        }
                );
                $.fn.dataTable.TableTools.buttons.editrow = $.extend(
                        {}, $.fn.dataTable.TableTools.BUTTONS.select,
                        {
                            "sButtonText": "<i class=\"fa fa-edit\"></i>",
                            "sToolTip": "Edit Data",
                            "fnClick": function (nButton, oConfig) {
                                $state.go('app.form.elt', {id: (this.fnGetSelectedData()[0]).code, categorie: $scope.categorie});
                            }
                        }
                );

                $.fn.dataTable.TableTools.buttons.delrow = $.extend(
                        {}, $.fn.dataTable.TableTools.BUTTONS.select,
                        {
                            "sButtonText": "<i class=\"fa fa-trash-o\"></i>",
                            "sToolTip": "Delete Data",
                            "fnClick": function (nButton, oConfig) {
                                //confirm dialogue
                                var r = confirm("Confirm ?");
                                if (r == true) {
                                    $http.get($scope.categorie + '/del/' + (this.fnGetSelectedData()[0]).code)
                                            .success(function (data) {
                                                toaster.pop("success", "Success", "Suppression Effectuée avec Succès");
                                                $('#dataTables-example').DataTable().ajax.reload();
                                            }).error(function (data) {
                                        toaster.pop("error", "Error", data);
                                        $('#dataTables-example').DataTable().ajax.reload();
                                    });
                                }
                                ;

                            }
                        }
                );


            });
</script>


